#!/bin/bash

# Function to prompt for user input
prompt_for_input() {
    read -p "$1: " input
    echo "$input"
}

# Prompt for the username
username=$(prompt_for_input "Enter the username to create")

# Prompt for the UID
uid=$(prompt_for_input "Enter the UID for the user")

# Prompt for the public key
public_key=$(prompt_for_input "Enter the public key for the user")

# Create the user on the buildhost
group="PlatformAdmins"
useradd "$username" -g "$group" -u "$uid" -m -c "PlatformAdmin"
mkdir -p "/home/$username/.ssh"
touch "/home/$username/.ssh/authorized_keys"
chmod 700 "/home/$username/.ssh"
chmod 600 "/home/$username/.ssh/authorized_keys"
chown -R "$username:$group" "/home/$username"

# Append the public key to the authorized_keys file
echo "$public_key" > "/home/$username/.ssh/authorized_keys"
chown "$username:$group" "/home/$username/.ssh/authorized_keys"

echo "User $username created successfully on the buildhost with UID $uid and SSH key configured."

